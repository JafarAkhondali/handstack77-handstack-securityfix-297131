<?xml version="1.0" encoding="UTF-8"?>
<mapper xmlns="contract.xsd">
    <header>
        <application>HDS</application>
        <project>HML</project>
        <transaction>HML011</transaction>
        <datasource>DB01</datasource>
        <use>Y</use>
        <desc>프로젝트 담당자 초대</desc>
    </header>
    <commands>
        <statement id="ID01" seq="0" use="Y" timeout="0" desc="프로젝트 담당자 정보 변경" modified="2020-07-31 00:00:00">
            <![CDATA[
INSERT INTO ApplicationMember (ApplicationNo
    , EmailID
    , MemberNo
    , MemberStatus
    , RoleDevelop
    , RoleBusiness
    , RoleOperation
    , RoleManaged
    , ExpiredAt
    , CreatedMemberNo
    , CreatedAt)
SELECT @ApplicationNo
    , @UserEmailID1
    , IFNULL((SELECT MemberNo FROM [Member] WHERE EmailID = @UserEmailID1), '')
    , 'R'
    , CASE WHEN @RoleDevelop1 = '1' THEN 'Y' ELSE 'N' END
    , CASE WHEN @RoleBusiness1 = '1' THEN 'Y' ELSE 'N' END
    , CASE WHEN @RoleOperation1 = '1' THEN 'Y' ELSE 'N' END
    , CASE WHEN @RoleManaged1 = '1' THEN 'Y' ELSE 'N' END
    , datetime('now', '+1 year')
    , @CreatedMemberNo
    , CURRENT_TIMESTAMP
WHERE NOT EXISTS (SELECT EmailID FROM ApplicationMember WHERE ApplicationNo = @ApplicationNo AND EmailID = @UserEmailID1);

INSERT INTO ApplicationMember (ApplicationNo
    , EmailID
    , MemberNo
    , MemberStatus
    , RoleDevelop
    , RoleBusiness
    , RoleOperation
    , RoleManaged
    , ExpiredAt
    , CreatedMemberNo
    , CreatedAt)
SELECT @ApplicationNo
    , @UserEmailID2
    , IFNULL((SELECT MemberNo FROM [Member] WHERE EmailID = @UserEmailID2), '')
    , 'R'
    , CASE WHEN @RoleDevelop2 = '1' THEN 'Y' ELSE 'N' END
    , CASE WHEN @RoleBusiness2 = '1' THEN 'Y' ELSE 'N' END
    , CASE WHEN @RoleOperation2 = '1' THEN 'Y' ELSE 'N' END
    , CASE WHEN @RoleManaged2 = '1' THEN 'Y' ELSE 'N' END
    , datetime('now', '+1 year')
    , @CreatedMemberNo
    , CURRENT_TIMESTAMP
WHERE NOT EXISTS (SELECT EmailID FROM ApplicationMember WHERE ApplicationNo = @ApplicationNo AND EmailID = @UserEmailID2);
    
INSERT INTO ApplicationMember (ApplicationNo
    , EmailID
    , MemberNo
    , MemberStatus
    , RoleDevelop
    , RoleBusiness
    , RoleOperation
    , RoleManaged
    , ExpiredAt
    , CreatedMemberNo
    , CreatedAt)
SELECT @ApplicationNo
    , @UserEmailID3
    , IFNULL((SELECT MemberNo FROM [Member] WHERE EmailID = @UserEmailID3), '')
    , 'R'
    , CASE WHEN @RoleDevelop3 = '1' THEN 'Y' ELSE 'N' END
    , CASE WHEN @RoleBusiness3 = '1' THEN 'Y' ELSE 'N' END
    , CASE WHEN @RoleOperation3 = '1' THEN 'Y' ELSE 'N' END
    , CASE WHEN @RoleManaged3 = '1' THEN 'Y' ELSE 'N' END
    , datetime('now', '+1 year')
    , @CreatedMemberNo
    , CURRENT_TIMESTAMP
WHERE NOT EXISTS (SELECT EmailID FROM ApplicationMember WHERE ApplicationNo = @ApplicationNo AND EmailID = @UserEmailID3);
			]]>
            <param id="@ApplicationNo" type="String" length="36" value="" />
            <param id="@UserEmailID1" type="String" length="256" value="" />
            <param id="@RoleDevelop1" type="String" length="1" value="" />
            <param id="@RoleBusiness1" type="String" length="1" value="" />
            <param id="@RoleOperation1" type="String" length="1" value="" />
            <param id="@RoleManaged1" type="String" length="1" value="" />
            <param id="@UserEmailID2" type="String" length="256" value="" />
            <param id="@RoleDevelop2" type="String" length="1" value="" />
            <param id="@RoleBusiness2" type="String" length="1" value="" />
            <param id="@RoleOperation2" type="String" length="1" value="" />
            <param id="@RoleManaged2" type="String" length="1" value="" />
            <param id="@UserEmailID3" type="String" length="256" value="" />
            <param id="@RoleDevelop3" type="String" length="1" value="" />
            <param id="@RoleBusiness3" type="String" length="1" value="" />
            <param id="@RoleOperation3" type="String" length="1" value="" />
            <param id="@RoleManaged3" type="String" length="1" value="" />
            <param id="@CreatedMemberNo" type="String" length="36" value="" />
        </statement>
    </commands>
</mapper>