<?xml version="1.0" encoding="UTF-8"?>
<mapper xmlns="contract.xsd">
    <header>
        <datasource>DB01</datasource>
        <use>Y</use>
        <desc>문서양식 > 일반업무 > 주간 업무 보고</desc>
    </header>
    <commands>
        <statement id="GD01" seq="0" use="Y" timeout="0" desc="문서 조회">
            <![CDATA[
SELECT DF.DocumentNo
    , DF.FormID
    , DF.Title
    , DF.Note
    , DF.PrevWorkSchedule
    , DF.Period
    , DF.WorkDate
    , DF.CreatorName
    , DF.Tags
    , DF.CreatedAt
FROM 
    DocumentForm DF
WHERE DF.DocumentNo = @DocumentNo
    AND DF.FormID = @FormID;

SELECT DD.DetailNo
    , DD.DocumentNo
    , DD.ExecutionWorkName
    , DD.ProgressRate
    , DD.DeadLineDate
FROM DocumentForm DF
    INNER JOIN DocumentDetail DD ON DF.DocumentNo = DD.DocumentNo
WHERE DD.DocumentNo = @DocumentNo
    AND DF.FormID = @FormID
    AND DD.DetailCategory = 'DetailItems1';
    
SELECT DD.DetailNo
    , DD.DocumentNo
    , DD.ExecutionWorkName
    , DD.PeriodName1
    , DD.PeriodName2
    , DD.PeriodName3
    , DD.PeriodName4
    , DD.PeriodName5
    , DD.PeriodName6
    , DD.PeriodName7
FROM DocumentForm DF
    INNER JOIN DocumentDetail DD ON DF.DocumentNo = DD.DocumentNo
WHERE DD.DocumentNo = @DocumentNo
    AND DF.FormID = @FormID
    AND DD.DetailCategory = 'DetailItems2';
			]]>
            <param id="@DocumentNo" type="String" length="-1" value="NULL" />
            <param id="@FormID" type="String" length="-1" value="NULL" />
        </statement>

        <statement id="MD01" seq="0" use="Y" timeout="0" desc="문서 입력, 수정">
            <if test="(Flag == 'C')">
                <![CDATA[
INSERT INTO DocumentForm
(
    DocumentNo
    , FormID
    , Title
    , Note
    , PrevWorkSchedule
    , Period
    , WorkDate
    , CreatorName
    , Tags
    , CreatedAt
) 
VALUES
(
    @DocumentNo
    , @FormID
    , @Title
    , @Note
    , @PrevWorkSchedule
    , @Period
    , @WorkDate
    , @CreatorName
    , @Tags
    , DATETIME('NOW', 'localtime')
);
		        ]]>
            </if>

            <if test="(Flag == 'U')">
                <![CDATA[
UPDATE DocumentForm SET FormID = @FormID
    , Title = @Title
    , Note = @Note
    , PrevWorkSchedule = @PrevWorkSchedule
    , Period = @Period
    , WorkDate = @WorkDate
    , CreatorName = @CreatorName
    , Tags = @Tags
	, ModifiedAt = DATETIME('NOW', 'localtime')
WHERE DocumentNo = @DocumentNo;
		        ]]>
            </if>

            <![CDATA[
SELECT @DocumentNo AS DocumentNo;
		    ]]>
            <param id="@DocumentNo" type="String" length="36" value="NULL" />
            <param id="@FormID" type="String" length="10" value="NULL" />
            <param id="@Title" type="String" length="100" value="NULL" />
            <param id="@PrevWorkSchedule" type="String" length="-1" value="NULL" />
            <param id="@Note" type="String" length="4000" value="NULL" />
            <param id="@WorkDate" type="String" length="10" value="NULL" />
            <param id="@Period" type="String" length="50" value="NULL" />
            <param id="@CreatorName" type="String" length="50" value="NULL" />
            <param id="@Tags" type="String" length="200" value="NULL" />
        </statement>

        <statement id="MD01" seq="1" use="Y" timeout="0" desc="문서 상세 1 입력, 수정, 삭제">
            <if test="(Flag == 'C')">
                <![CDATA[
INSERT INTO DocumentDetail
(
    DocumentNo
    , ExecutionWorkName
    , ProgressRate
    , DeadLineDate
    , DetailCategory
    , CreatedAt
) 
VALUES
(
    @DocumentNo
    , @ExecutionWorkName
    , @ProgressRate
    , @DeadLineDate
    , 'DetailItems1'
    , DATETIME('NOW', 'localtime')
);
		        ]]>
            </if>

            <if test="(Flag == 'U')">
                <![CDATA[
UPDATE DocumentDetail SET ExecutionWorkName = @ExecutionWorkName
    , ProgressRate = @ProgressRate
    , DeadLineDate = @DeadLineDate
	, ModifiedAt = DATETIME('NOW', 'localtime')
WHERE DetailNo = @DetailNo
    AND DocumentNo = @DocumentNo
    AND DetailCategory = 'DetailItems1';
		        ]]>
            </if>

            <if test="(Flag == 'D')">
                <![CDATA[
DELETE FROM DocumentDetail
WHERE DetailNo = @DetailNo
    AND DocumentNo = @DocumentNo
    AND DetailCategory = 'DetailItems1';
		        ]]>
            </if>
            <param id="@DetailNo" type="Int32" length="-1" value="NULL" />
            <param id="@DocumentNo" type="String" length="36" value="NULL" />
            <param id="@ExecutionWorkName" type="String" length="200" value="NULL" />
            <param id="@ProgressRate" type="String" length="50" value="NULL" />
            <param id="@DeadLineDate" type="String" length="10" value="NULL" />
        </statement>

        <statement id="MD01" seq="2" use="Y" timeout="0" desc="문서 상세 2 입력, 수정, 삭제">
            <if test="(Flag == 'C')">
                <![CDATA[
INSERT INTO DocumentDetail
(
    DocumentNo
    , ExecutionWorkName
    , PeriodName1
    , PeriodName2
    , PeriodName3
    , PeriodName4
    , PeriodName5
    , PeriodName6
    , PeriodName7
    , DetailCategory
    , CreatedAt
) 
VALUES
(
    @DocumentNo
    , @ExecutionWorkName
    , @PeriodName1
    , @PeriodName2
    , @PeriodName3
    , @PeriodName4
    , @PeriodName5
    , @PeriodName6
    , @PeriodName7
    , 'DetailItems2'
    , DATETIME('NOW', 'localtime')
);
		        ]]>
            </if>

            <if test="(Flag == 'U')">
                <![CDATA[
UPDATE DocumentDetail SET ExecutionWorkName = @ExecutionWorkName
    , PeriodName1 = @PeriodName1
    , PeriodName2 = @PeriodName2
    , PeriodName3 = @PeriodName3
    , PeriodName4 = @PeriodName4
    , PeriodName5 = @PeriodName5
    , PeriodName6 = @PeriodName6
    , PeriodName7 = @PeriodName7
	, ModifiedAt = DATETIME('NOW', 'localtime')
WHERE DetailNo = @DetailNo
    AND DocumentNo = @DocumentNo
    AND DetailCategory = 'DetailItems2';
		        ]]>
            </if>

            <if test="(Flag == 'D')">
                <![CDATA[
DELETE FROM DocumentDetail
WHERE DetailNo = @DetailNo
    AND DocumentNo = @DocumentNo
    AND DetailCategory = 'DetailItems2';
		        ]]>
            </if>
            <param id="@DetailNo" type="Int32" length="-1" value="NULL" />
            <param id="@DocumentNo" type="String" length="36" value="NULL" />
            <param id="@ExecutionWorkName" type="String" length="200" value="NULL" />
            <param id="@PeriodName1" type="String" length="10" value="NULL" />
            <param id="@PeriodName2" type="String" length="10" value="NULL" />
            <param id="@PeriodName3" type="String" length="10" value="NULL" />
            <param id="@PeriodName4" type="String" length="10" value="NULL" />
            <param id="@PeriodName5" type="String" length="10" value="NULL" />
            <param id="@PeriodName6" type="String" length="10" value="NULL" />
            <param id="@PeriodName7" type="String" length="10" value="NULL" />
        </statement>

        <statement id="DD01" seq="0" use="Y" timeout="0" desc="문서 삭제">
            <![CDATA[
DELETE FROM DocumentDetail
WHERE DocumentNo = @DocumentNo;
    
DELETE FROM DocumentForm
WHERE DocumentNo = @DocumentNo;
			]]>
            <param id="@DocumentNo" type="String" length="-1" value="NULL" />
        </statement>
    </commands>
</mapper>